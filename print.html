<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Feather</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/starting-a-server.html"><strong aria-hidden="true">1.1.</strong> Starting a server</a></li><li class="chapter-item expanded "><a href="getting-started/config.html"><strong aria-hidden="true">1.2.</strong> Configuring a server</a></li></ol></li><li class="chapter-item expanded "><a href="plugin/index.html"><strong aria-hidden="true">2.</strong> Developing a plugin</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="plugin/concepts/intro.html"><strong aria-hidden="true">2.1.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="plugin/concepts/entity-component.html"><strong aria-hidden="true">2.1.1.</strong> Entity and Component</a></li><li class="chapter-item expanded "><a href="plugin/concepts/resource.html"><strong aria-hidden="true">2.1.2.</strong> Resource</a></li><li class="chapter-item expanded "><a href="plugin/concepts/world.html"><strong aria-hidden="true">2.1.3.</strong> World</a></li><li class="chapter-item expanded "><a href="plugin/concepts/system.html"><strong aria-hidden="true">2.1.4.</strong> System</a></li></ol></li><li class="chapter-item expanded "><a href="plugin/lieutenant/index.html"><strong aria-hidden="true">2.2.</strong> Command handling</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Feather</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#getting-started" id="getting-started">Getting started</a></h1>
<p>Feather is distributed as a single binary and can run on almost any system, see <a href="getting-started/./starting-a-server.html">Starting a server</a>.</p>
<h1><a class="header" href="#starting-a-server" id="starting-a-server">Starting a server</a></h1>
<p>The latest version of feather can be found and downloaded from our <a href="https://github.com/feather-rs/feather/releases">github release page</a>. Feather is platform dependent, therefor you must download the version corresponding to your operating system and your processors architecture.</p>
<p>The zip file contains a single executable that is compiled to the given target that when executed will generate a few files notable <code>world/</code> and <code>feather.toml</code>, so it is recommended to execute the server in a separate folder.</p>
<h2><a class="header" href="#windows" id="windows">Windows</a></h2>
<p>After downloading and unzipping the executable <code>feather.exe</code> you can start it by simply double clicking it.</p>
<h2><a class="header" href="#mac-os-x" id="mac-os-x">Mac OS-X</a></h2>
<p>After downloading and unzipping you can execute feather from the terminal</p>
<pre><code>./feather
</code></pre>
<h2><a class="header" href="#linux" id="linux">Linux</a></h2>
<p>After downloading and unzipping you can execute feather from the terminal</p>
<pre><code>./feather
</code></pre>
<h1><a class="header" href="#configuring" id="configuring">Configuring</a></h1>
<p>Feather config files are written in the <a href="https://github.com/toml-lang/toml/blob/master/README.md"><strong>TOML</strong></a> format. </p>
<h3><a class="header" href="#feathertoml" id="feathertoml">feather.toml</a></h3>
<pre><code class="language-toml"># Configuration for the Feather server.

# Many of the options here are unimplemented and have no effect.
# Those that are unimplemented have been labeled so.

[io]
# Packets with a size more than or equal to this value will be sent compressed.
# Compressing packets reduces bandwidth usage but increases CPU activity.
compression_threshold = 256

[server]
online_mode = true
motd = &quot;A Feather server&quot;
max_players = 16
default_gamemode = &quot;survival&quot;
difficulty = &quot;none&quot; # Unimplemented
view_distance = 6
address = &quot;0.0.0.0&quot;
port = 25565

[gameplay]
monster_spawning = true # Unimplemented
animal_spawning = true # Unimplemented
pvp = true # Unimplemented
nerf_spawner_mobs = false # Unimplemented
# Either &quot;classic&quot; for 1.8 PvP or &quot;new&quot; for 1.9
pvp_style = &quot;classic&quot; # Unimplemented

[log]
# If you prefer less verbose logs, switch this to &quot;info.&quot;
# If you want to hurt your eyes while looking at the
# server console, set it to &quot;trace.&quot;
level = &quot;debug&quot;

[resource_pack]
# Server resource pack which is sent to players
# upon joining. Set this to an empty string to disable.
url = &quot;&quot;
# Optional SHA1 hash of the resource pack file.
hash = &quot;&quot;

[world]
# The name of the directory containing the world.
name = &quot;world&quot;
# The generator to use if the world does not exist.
# Implemented values are: default, flat
generator = &quot;default&quot;
# The seed to use if the world does not exist.
# Leaving this value empty will generate a random seed.
# If this value is not a valid integer (i64), the string
# will be converted using a hash function.
seed = &quot;&quot;
# Interval at which to save modified chunks.
save_interval = &quot;1min&quot;

[proxy]
# Select the IP forwarding mode that is used by proxies like BungeeCord or Velocity.
# Valid values are
# - &quot;None&quot; - for usage without a proxy
# - &quot;BungeeCord&quot; - for BungeeCord/Waterfall/Travertine
# - &quot;Velocity&quot; - for Velocity style proxies (unimplemented)
proxy_mode = &quot;None&quot;
</code></pre>
<h1><a class="header" href="#developing-a-plugin" id="developing-a-plugin">Developing a plugin</a></h1>
<p>Plugins written for Feather can achieve incredible flexibility through Feather's data-oriented API. Our plugin system has been written from the start to support any functionality imaginable, to the extent all gameplay features could be implemented as plugins if needed. However writing a plugin for feather is very different from writing a plugin for any other Minecraft Server software.</p>
<h1><a class="header" href="#concepts" id="concepts">Concepts</a></h1>
<p>Feather is quite a bit different from regular Minecraft server software written in Java. Feather is written using the <a href="https://en.wikipedia.org/wiki/Entity_component_system"><em>Entity Component System</em></a> architecture, which greatly improves the utilization of the CPU, most notable being improved cache hit ratio compared to <a href="https://en.wikipedia.org/wiki/Object-oriented_programming"><em>Object Oriented Programming</em></a>. </p>
<p>The following definitions is used throughout the book to avoid confusion</p>
<ol>
<li><em>Entity</em> is used to associate data in ECS.</li>
<li><em>Component</em> is some data associated with a single <em>Entity</em> in ECS.</li>
<li><em>World</em> is a container of queryable data associated with <em>Entity's</em> in ECS.</li>
<li><em>Dimension</em>: Is a world in Minecraft.</li>
</ol>
<p>Feather uses <a href="https://github.com/feather-rs/fecs">Fecs</a> which is our own custom ECS built on top of <a href="https://docs.rs/legion/0.2.1/legion/">Legion</a>. We chose Legion as the base of our ECS due to its incredible query performance compared to its alternatives like <a href="https://docs.rs/specs/0.16.1/specs/">Specs</a>. The components that makes up an entity is called its archetype, Legion stores all its entities in chunks based on the archetype. This means that adding or removing components from an entity is an <code>O(n)</code> operation and should therefor be avoided. </p>
<p>Feather is structured with a number of systems running in series, these system may perform their calculations in parallel by utilizing <a href="https://docs.rs/rayon/1.3.0/rayon/"><em>Rayon</em></a>. These systems emit events that effects their outcome, for instance the <code>block_place_system</code> system emits both <code>BlockChangeEvent</code> and <code>InteractItemEvent</code>. The listeners attached to these events may poll in arbitrary data from the world and this is the major reason Systems are run in series and not parallel.</p>
<p>In the following chapters we will cover <a href="https://en.wikipedia.org/wiki/Entity_component_system"><em>Entity Component System</em></a> and how it is utilized within feather and how you should interact with them. We will also cover the event bus and how we merge tasks into the main Game Loop through the scheduler. </p>
<h1><a class="header" href="#chapters" id="chapters">Chapters</a></h1>
<ol>
<li><a href="plugin/concepts/./entity-component.html">Entity Component</a></li>
<li><a href="plugin/concepts/./world.html">World</a></li>
<li><a href="plugin/concepts/./resource.html">Resource</a></li>
<li><a href="plugin/concepts/./system.html">System</a></li>
</ol>
<h3><a class="header" href="#additional-resources" id="additional-resources">Additional resources</a></h3>
<ol>
<li>Theres a great <a href="https://kyren.github.io/2018/09/14/rustconf-talk.html">talk</a> on ECS from <a href="https://2018.rustconf.com/">RustConf 2018</a>.</li>
<li>Theres a great comparison between <a href="https://docs.rs/specs/0.16.1/specs/">Specs</a> and <a href="https://docs.rs/legion/0.2.1/legion/">Legion</a> <a href="https://csherratt.github.io/blog/posts/specs-and-legion/">here</a> by Cora Sherratt who worked on specs.</li>
</ol>
<h1><a class="header" href="#entity-and-component" id="entity-and-component">Entity and Component</a></h1>
<h2><a class="header" href="#what-are-entity-and-component" id="what-are-entity-and-component">What are <code>Entity</code> and <code>Component</code></a></h2>
<p>An <code>Entity</code> is some unique identifier in the world. The <code>Entity</code> has a number of <code>Components</code>, these components are nothing more than simple data type. For example a Player entity has Health, Position, and etc. associated, it is also common for entities to have some tag associated that describe the type. In the case of a Player it would be some <code>Player</code> struct mark the entity as a Player.</p>
<h2><a class="header" href="#example" id="example">Example</a></h2>
<p>Let try to define <em>Player</em> and <em>Zombie</em> as entities in ECS with <code>Health</code> and <code>Position</code>.</p>
<table><thead><tr><th>Player</th><th>Zombie</th><th>Health</th><th>Position</th></tr></thead><tbody>
<tr><td>Player</td><td></td><td>20.0</td><td>0.0, 0.0, 0.0</td></tr>
<tr><td></td><td>Zombie</td><td>15.0</td><td>0.0, 0.0, 0.0</td></tr>
</tbody></table>
<p>Both <em>Player</em> and <em>Zombie</em> share the components <code>Health</code> and <code>Position</code> but not the components <code>Player</code> and <code>Zombie</code> that is used to mark the type of the entity.</p>
<p>We can declare the above components as the following</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>// Component used to mark an entity as a player
struct Player;

// Component used to mark an entity as a Zombie
struct Zombie;

// Component storing health
struct Health(f64);

// Component storing position
struct Position {
    x: f64,
    y: f64,
    z: f64,
}
<span class="boring">}
</span></code></pre></pre>
<p>Now that we have declared the a few components we can create two entities with the given components and insert it into a world. In a later <a href="plugin/concepts/./world.html">chapter on world</a> we will cover insertion in depth and what it actually means.</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use fecs::EntityBuilder;

EntityBuilder::new()
    .with(Player)
    .with(Health(20.0))
    .with(Postion {
        x: 0.0,
        y: 0.0,
        z: 0.0,
    })
    .build()
    .spawn_in(&amp;mut world);

EntityBuilder::new()
    .with(Zombie)
    .with(Health(15.0))
    .with(Position {
        x: 0.0,
        y: 0.0,
        z: 0.0,
    })
    .build()
    .spawn_in(&amp;mut world);
<span class="boring">}
</span></code></pre></pre>
<p>By calling <code>BuiltEntity::spawn</code> we create two new chunks, in the world, where the entities of the archetypes, <code>{Player, Health, Position}</code> and <code>{Zombie, Health, Position}</code> are stored. We can add additional components to an entity by calling <code>World::add</code>, however this will change the archetype of the entity and we would have to move the entire entity to a new chunk. This is an expensive operation and involves copying all components to a new chunk in heap, it takes <code>O(n)</code> and therefor should be avoided if possible, this is the same cost as create an entire new entity. In most cases where you find your self adding and removing some component from an entity a mutable component can be used instead, it has greatly improved performance due to the entity not changing its archetype, it is an <code>O(1)</code> operation and is very cheap compared to <code>World::add</code>.</p>
<h1><a class="header" href="#resource" id="resource">Resource</a></h1>
<h1><a class="header" href="#world" id="world">World</a></h1>
<p>When writing plugins for feather you will rarely have to create your own world, since feather provides two worlds that one of which are available asynchronous. But for the purpose of demonstrating ECS will be crating our own world, which is no different from a provided one.</p>
<p>We can create a world in Fecs by simply calling <code>World::new</code>.</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use fecs::World;

let world = World::new();
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#system" id="system">System</a></h1>
<h1><a class="header" href="#command-handling" id="command-handling">Command handling</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
